{"ast":null,"code":"var _jsxFileName = \"E:\\\\Projects\\\\starsofboston\\\\next-django\\\\isomorphic-next\\\\components\\\\Admin\\\\Property\\\\PricingCalendar\\\\PricingCalendar.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport moment from \"moment\";\nimport { Calendar, momentLocalizer } from \"react-big-calendar\";\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\nimport ModalEvents from \"./ModalEvents\";\nimport notification from \"@iso/components/Notification\";\nimport propertyActions from \"@redux/properties/actions\";\nimport { CalendarStyleWrapper } from \"./Calendar.styles\";\nconst Localizer = momentLocalizer(moment);\nconst DragAndDropCalendar = withDragAndDrop(Calendar);\nexport default function PricingCalendar(props) {\n  const {\n    propertyId,\n    defaultPrice\n  } = props;\n  const {\n    0: pricingItems,\n    1: setPricingItems\n  } = useState([]);\n  const {\n    0: modalVisible,\n    1: setModalVisible\n  } = useState(false);\n  const {\n    0: modalData,\n    1: setModalData\n  } = useState(null);\n  const dispatch = useDispatch();\n  const {\n    selectedItem\n  } = useSelector(state => state.Properties);\n  useEffect(() => {\n    getPricingData(propertyId);\n  }, []);\n  useEffect(() => {\n    if (selectedItem.pricingItems) {\n      const newItems = selectedItem.pricingItems.map((item, index) => ({\n        price: item.price,\n        allDay: true,\n        start: item.start_date,\n        end: item.end_date\n      }));\n      setPricingItems(newItems);\n      console.log(\"selectedItem\", newItems, pricingItems);\n    }\n  }, [selectedItem]);\n\n  async function getPricingData() {\n    dispatch(propertyActions.getPriceItems(propertyId));\n  }\n\n  const handleSlotSelection = ({\n    start,\n    end,\n    action\n  }) => {\n    setModalVisible(true);\n    setModalData({\n      price: defaultPrice,\n      start: convertDate(start),\n      end: convertDate(end)\n    });\n  };\n\n  const convertDate = date => {\n    const offset = date.getTimezoneOffset();\n    console.log(\"offset\", offset);\n    const newDate = new Date(date.getTime() - offset * 60 * 1000);\n    return newDate.toISOString().split(\"T\")[0];\n  };\n\n  const handleChangeModalData = (type, modalData) => {\n    if (type === \"cancel\") {\n      setModalVisible(false);\n      setModalData(null);\n    } else if (type === \"delete\") {// some logic to delete pricing item\n    } else if (type === \"updateValue\") {\n      console.log(\"updateValue\", modalData);\n      setModalData({\n        price: modalData.price,\n        start: modalData.start,\n        end: modalData.end\n      });\n    } else {\n      dispatch(propertyActions.createPriceItem({\n        start_date: modalData.start,\n        end_date: modalData.end,\n        price: modalData.price,\n        property: propertyId\n      }, dispatch));\n      setModalVisible(false);\n    }\n  };\n\n  return __jsx(CalendarStyleWrapper, {\n    className: \"isomorphicCalendarWrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }\n  }, __jsx(ModalEvents, {\n    modalVisible: modalVisible,\n    modalData: modalData,\n    onModalDataChange: handleChangeModalData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }), __jsx(Calendar // className=\"isomorphicCalendar\"\n  // selectable\n  // localizer={Localizer}\n  // onView={onView}\n  // defaultView=\"month\"\n  // step={60}\n  , {\n    selectable: true,\n    resizable: true,\n    events: pricingItems,\n    views: [\"month\"],\n    defaultDate: new Date(),\n    defaultView: \"month\",\n    toolbar: true,\n    localizer: Localizer,\n    step: 30,\n    components: {\n      month: {\n        dateHeader: ({\n          date,\n          label\n        }) => {\n          let pricingItem = pricingItems.find(item => moment(date).isBetween(moment(item.start), moment(item.end), null, \"[]\"));\n          return __jsx(\"div\", {\n            className: \"calendar-date-cell\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 121,\n              columnNumber: 33\n            }\n          }, __jsx(\"h4\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 37\n            }\n          }, moment(date).date()), __jsx(\"h6\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 37\n            }\n          }, \"$\", \" \", pricingItem !== undefined ? pricingItem.price : defaultPrice));\n        }\n      }\n    },\n    onSelectSlot: handleSlotSelection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }));\n}","map":{"version":3,"sources":["E:/Projects/starsofboston/next-django/isomorphic-next/components/Admin/Property/PricingCalendar/PricingCalendar.js"],"names":["React","useState","useEffect","useDispatch","useSelector","moment","Calendar","momentLocalizer","withDragAndDrop","ModalEvents","notification","propertyActions","CalendarStyleWrapper","Localizer","DragAndDropCalendar","PricingCalendar","props","propertyId","defaultPrice","pricingItems","setPricingItems","modalVisible","setModalVisible","modalData","setModalData","dispatch","selectedItem","state","Properties","getPricingData","newItems","map","item","index","price","allDay","start","start_date","end","end_date","console","log","getPriceItems","handleSlotSelection","action","convertDate","date","offset","getTimezoneOffset","newDate","Date","getTime","toISOString","split","handleChangeModalData","type","createPriceItem","property","month","dateHeader","label","pricingItem","find","isBetween","undefined"],"mappings":";;AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAyBC,SAAzB,QAAyC,OAAzC;AACA,SAAQC,WAAR,EAAqBC,WAArB,QAAuC,aAAvC;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAAQC,QAAR,EAAkBC,eAAlB,QAAwC,oBAAxC;AACA,OAAOC,eAAP,MAA4B,2CAA5B;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,YAAP,MAAyB,8BAAzB;AACA,OAAOC,eAAP,MAA4B,2BAA5B;AAEA,SAAQC,oBAAR,QAAmC,mBAAnC;AAEA,MAAMC,SAAS,GAAGN,eAAe,CAACF,MAAD,CAAjC;AACA,MAAMS,mBAAmB,GAAGN,eAAe,CAACF,QAAD,CAA3C;AAEA,eAAe,SAASS,eAAT,CAAyBC,KAAzB,EAAgC;AAC3C,QAAM;AAACC,IAAAA,UAAD;AAAaC,IAAAA;AAAb,MAA6BF,KAAnC;AAEA,QAAM;AAAA,OAACG,YAAD;AAAA,OAAeC;AAAf,MAAkCnB,QAAQ,CAAC,EAAD,CAAhD;AACA,QAAM;AAAA,OAACoB,YAAD;AAAA,OAAeC;AAAf,MAAkCrB,QAAQ,CAAC,KAAD,CAAhD;AACA,QAAM;AAAA,OAACsB,SAAD;AAAA,OAAYC;AAAZ,MAA4BvB,QAAQ,CAAC,IAAD,CAA1C;AAEA,QAAMwB,QAAQ,GAAGtB,WAAW,EAA5B;AACA,QAAM;AAACuB,IAAAA;AAAD,MAAiBtB,WAAW,CAAEuB,KAAD,IAAWA,KAAK,CAACC,UAAlB,CAAlC;AAEA1B,EAAAA,SAAS,CAAC,MAAM;AACZ2B,IAAAA,cAAc,CAACZ,UAAD,CAAd;AACH,GAFQ,EAEN,EAFM,CAAT;AAIAf,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAIwB,YAAY,CAACP,YAAjB,EAA+B;AAC3B,YAAMW,QAAQ,GAAGJ,YAAY,CAACP,YAAb,CAA0BY,GAA1B,CAA8B,CAACC,IAAD,EAAOC,KAAP,MAAkB;AAC7DC,QAAAA,KAAK,EAAEF,IAAI,CAACE,KADiD;AAE7DC,QAAAA,MAAM,EAAE,IAFqD;AAG7DC,QAAAA,KAAK,EAAEJ,IAAI,CAACK,UAHiD;AAI7DC,QAAAA,GAAG,EAAEN,IAAI,CAACO;AAJmD,OAAlB,CAA9B,CAAjB;AAMAnB,MAAAA,eAAe,CAACU,QAAD,CAAf;AACAU,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BX,QAA5B,EAAsCX,YAAtC;AACH;AACJ,GAXQ,EAWN,CAACO,YAAD,CAXM,CAAT;;AAaA,iBAAeG,cAAf,GAAgC;AAC5BJ,IAAAA,QAAQ,CAACd,eAAe,CAAC+B,aAAhB,CAA8BzB,UAA9B,CAAD,CAAR;AACH;;AAED,QAAM0B,mBAAmB,GAAG,CAAC;AAACP,IAAAA,KAAD;AAAQE,IAAAA,GAAR;AAAaM,IAAAA;AAAb,GAAD,KAA0B;AAClDtB,IAAAA,eAAe,CAAC,IAAD,CAAf;AACAE,IAAAA,YAAY,CAAC;AACTU,MAAAA,KAAK,EAAEhB,YADE;AAETkB,MAAAA,KAAK,EAAES,WAAW,CAACT,KAAD,CAFT;AAGTE,MAAAA,GAAG,EAAEO,WAAW,CAACP,GAAD;AAHP,KAAD,CAAZ;AAKH,GAPD;;AASA,QAAMO,WAAW,GAAIC,IAAD,IAAU;AAC1B,UAAMC,MAAM,GAAGD,IAAI,CAACE,iBAAL,EAAf;AACAR,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBM,MAAtB;AACA,UAAME,OAAO,GAAG,IAAIC,IAAJ,CAASJ,IAAI,CAACK,OAAL,KAAiBJ,MAAM,GAAG,EAAT,GAAc,IAAxC,CAAhB;AACA,WAAOE,OAAO,CAACG,WAAR,GAAsBC,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAAP;AACH,GALD;;AAOA,QAAMC,qBAAqB,GAAG,CAACC,IAAD,EAAOhC,SAAP,KAAqB;AAC/C,QAAIgC,IAAI,KAAK,QAAb,EAAuB;AACnBjC,MAAAA,eAAe,CAAC,KAAD,CAAf;AACAE,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACH,KAHD,MAGO,IAAI+B,IAAI,KAAK,QAAb,EAAuB,CAC1B;AACH,KAFM,MAEA,IAAIA,IAAI,KAAK,aAAb,EAA4B;AAC/Bf,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BlB,SAA3B;AACAC,MAAAA,YAAY,CAAC;AACTU,QAAAA,KAAK,EAAEX,SAAS,CAACW,KADR;AAETE,QAAAA,KAAK,EAAEb,SAAS,CAACa,KAFR;AAGTE,QAAAA,GAAG,EAAEf,SAAS,CAACe;AAHN,OAAD,CAAZ;AAKH,KAPM,MAOA;AACHb,MAAAA,QAAQ,CAACd,eAAe,CAAC6C,eAAhB,CAAgC;AACrCnB,QAAAA,UAAU,EAAEd,SAAS,CAACa,KADe;AAErCG,QAAAA,QAAQ,EAAEhB,SAAS,CAACe,GAFiB;AAGrCJ,QAAAA,KAAK,EAAEX,SAAS,CAACW,KAHoB;AAIrCuB,QAAAA,QAAQ,EAAExC;AAJ2B,OAAhC,EAKNQ,QALM,CAAD,CAAR;AAMAH,MAAAA,eAAe,CAAC,KAAD,CAAf;AACH;AACJ,GAtBD;;AAwBA,SACI,MAAC,oBAAD;AAAsB,IAAA,SAAS,EAAC,2BAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,MAAC,WAAD;AACI,IAAA,YAAY,EAAED,YADlB;AAEI,IAAA,SAAS,EAAEE,SAFf;AAGI,IAAA,iBAAiB,EAAE+B,qBAHvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAMI,MAAC,QAAD,CACI;AACA;AACA;AACA;AACA;AACA;AANJ;AAOI,IAAA,UAAU,MAPd;AAQI,IAAA,SAAS,MARb;AASI,IAAA,MAAM,EAAEnC,YATZ;AAUI,IAAA,KAAK,EAAE,CAAC,OAAD,CAVX;AAWI,IAAA,WAAW,EAAE,IAAI+B,IAAJ,EAXjB;AAYI,IAAA,WAAW,EAAC,OAZhB;AAaI,IAAA,OAAO,EAAE,IAbb;AAcI,IAAA,SAAS,EAAErC,SAdf;AAeI,IAAA,IAAI,EAAE,EAfV;AAgBI,IAAA,UAAU,EAAE;AACR6C,MAAAA,KAAK,EAAE;AACHC,QAAAA,UAAU,EAAE,CAAC;AAACb,UAAAA,IAAD;AAAOc,UAAAA;AAAP,SAAD,KAAmB;AAC3B,cAAIC,WAAW,GAAG1C,YAAY,CAAC2C,IAAb,CAAmB9B,IAAD,IAChC3B,MAAM,CAACyC,IAAD,CAAN,CAAaiB,SAAb,CACI1D,MAAM,CAAC2B,IAAI,CAACI,KAAN,CADV,EAEI/B,MAAM,CAAC2B,IAAI,CAACM,GAAN,CAFV,EAGI,IAHJ,EAII,IAJJ,CADc,CAAlB;AAQA,iBACI;AAAK,YAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAKjC,MAAM,CAACyC,IAAD,CAAN,CAAaA,IAAb,EAAL,CADJ,EAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACM,GADN,EAEKe,WAAW,KAAKG,SAAhB,GACKH,WAAW,CAAC3B,KADjB,GAEKhB,YAJV,CAFJ,CADJ;AAWH;AArBE;AADC,KAhBhB;AAyCI,IAAA,YAAY,EAAEyB,mBAzClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANJ,CADJ;AAqDH","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport moment from \"moment\";\nimport {Calendar, momentLocalizer} from \"react-big-calendar\";\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\nimport ModalEvents from \"./ModalEvents\";\nimport notification from \"@iso/components/Notification\";\nimport propertyActions from \"@redux/properties/actions\";\n\nimport {CalendarStyleWrapper} from \"./Calendar.styles\";\n\nconst Localizer = momentLocalizer(moment);\nconst DragAndDropCalendar = withDragAndDrop(Calendar);\n\nexport default function PricingCalendar(props) {\n    const {propertyId, defaultPrice} = props;\n\n    const [pricingItems, setPricingItems] = useState([]);\n    const [modalVisible, setModalVisible] = useState(false);\n    const [modalData, setModalData] = useState(null);\n\n    const dispatch = useDispatch();\n    const {selectedItem} = useSelector((state) => state.Properties);\n\n    useEffect(() => {\n        getPricingData(propertyId);\n    }, []);\n\n    useEffect(() => {\n        if (selectedItem.pricingItems) {\n            const newItems = selectedItem.pricingItems.map((item, index) => ({\n                price: item.price,\n                allDay: true,\n                start: item.start_date,\n                end: item.end_date,\n            }));\n            setPricingItems(newItems);\n            console.log(\"selectedItem\", newItems, pricingItems)\n        }\n    }, [selectedItem]);\n\n    async function getPricingData() {\n        dispatch(propertyActions.getPriceItems(propertyId));\n    }\n\n    const handleSlotSelection = ({start, end, action}) => {\n        setModalVisible(true);\n        setModalData({\n            price: defaultPrice,\n            start: convertDate(start),\n            end: convertDate(end),\n        });\n    };\n\n    const convertDate = (date) => {\n        const offset = date.getTimezoneOffset();\n        console.log(\"offset\", offset);\n        const newDate = new Date(date.getTime() - offset * 60 * 1000);\n        return newDate.toISOString().split(\"T\")[0];\n    };\n\n    const handleChangeModalData = (type, modalData) => {\n        if (type === \"cancel\") {\n            setModalVisible(false);\n            setModalData(null);\n        } else if (type === \"delete\") {\n            // some logic to delete pricing item\n        } else if (type === \"updateValue\") {\n            console.log(\"updateValue\", modalData);\n            setModalData({\n                price: modalData.price,\n                start: modalData.start,\n                end: modalData.end,\n            });\n        } else {\n            dispatch(propertyActions.createPriceItem({\n                start_date: modalData.start,\n                end_date: modalData.end,\n                price: modalData.price,\n                property: propertyId\n            }, dispatch));\n            setModalVisible(false)\n        }\n    };\n\n    return (\n        <CalendarStyleWrapper className=\"isomorphicCalendarWrapper\">\n            <ModalEvents\n                modalVisible={modalVisible}\n                modalData={modalData}\n                onModalDataChange={handleChangeModalData}\n            />\n            <Calendar\n                // className=\"isomorphicCalendar\"\n                // selectable\n                // localizer={Localizer}\n                // onView={onView}\n                // defaultView=\"month\"\n                // step={60}\n                selectable\n                resizable\n                events={pricingItems}\n                views={[\"month\"]}\n                defaultDate={new Date()}\n                defaultView=\"month\"\n                toolbar={true}\n                localizer={Localizer}\n                step={30}\n                components={{\n                    month: {\n                        dateHeader: ({date, label}) => {\n                            let pricingItem = pricingItems.find((item) =>\n                                moment(date).isBetween(\n                                    moment(item.start),\n                                    moment(item.end),\n                                    null,\n                                    \"[]\"\n                                )\n                            );\n                            return (\n                                <div className=\"calendar-date-cell\">\n                                    <h4>{moment(date).date()}</h4>\n                                    <h6>\n                                        ${\" \"}\n                                        {pricingItem !== undefined\n                                            ? pricingItem.price\n                                            : defaultPrice}\n                                    </h6>\n                                </div>\n                            );\n                        },\n                    },\n                }}\n                onSelectSlot={handleSlotSelection}\n            />\n\n        </CalendarStyleWrapper>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}