{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"E:\\\\Projects\\\\starsofboston\\\\next-django\\\\isomorphic-next\\\\components\\\\Admin\\\\Property\\\\PricingCalendar\\\\PricingCalendar.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport moment from \"moment\";\nimport { Calendar, momentLocalizer } from \"react-big-calendar\";\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\nimport ModalEvents from \"./ModalEvents\";\nimport notification from \"@iso/components/Notification\";\nimport propertyActions from \"@redux/properties/actions\";\nimport { CalendarStyleWrapper } from \"./Calendar.styles\";\nvar Localizer = momentLocalizer(moment);\nvar DragAndDropCalendar = withDragAndDrop(Calendar);\n_c = DragAndDropCalendar;\nexport default function PricingCalendar(props) {\n  _s();\n\n  var _this = this;\n\n  var propertyId = props.propertyId,\n      defaultPrice = props.defaultPrice;\n\n  var _useState = useState([]),\n      pricingItems = _useState[0],\n      setPricingItems = _useState[1];\n\n  var _useState2 = useState(false),\n      modalVisible = _useState2[0],\n      setModalVisible = _useState2[1];\n\n  var _useState3 = useState(null),\n      modalData = _useState3[0],\n      setModalData = _useState3[1];\n\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.Properties;\n  }),\n      selectedItem = _useSelector.selectedItem;\n\n  useEffect(function () {\n    getPricingData(propertyId);\n  }, []);\n  useEffect(function () {\n    if (selectedItem.pricingItems) {\n      var newItems = selectedItem.pricingItems.map(function (item, index) {\n        return {\n          price: item.price,\n          allDay: true,\n          start: item.start_date,\n          end: item.end_date\n        };\n      });\n      setPricingItems(newItems);\n      console.log(\"selectedItem\", newItems, pricingItems);\n    }\n  }, [selectedItem]);\n\n  function getPricingData() {\n    return _getPricingData.apply(this, arguments);\n  }\n\n  function _getPricingData() {\n    _getPricingData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(propertyActions.getPriceItems(propertyId));\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _getPricingData.apply(this, arguments);\n  }\n\n  var handleSlotSelection = function handleSlotSelection(_ref) {\n    var start = _ref.start,\n        end = _ref.end,\n        action = _ref.action;\n    setModalVisible(true);\n    setModalData({\n      price: defaultPrice,\n      start: convertDate(start),\n      end: convertDate(end)\n    });\n  };\n\n  var convertDate = function convertDate(date) {\n    var offset = date.getTimezoneOffset();\n    console.log(\"offset\", offset);\n    var newDate = new Date(date.getTime() - offset * 60 * 1000);\n    return newDate.toISOString().split(\"T\")[0];\n  };\n\n  var handleChangeModalData = function handleChangeModalData(type, modalData) {\n    if (type === \"cancel\") {\n      setModalVisible(false);\n      setModalData(null);\n    } else if (type === \"delete\") {// some logic to delete pricing item\n    } else if (type === \"updateValue\") {\n      console.log(\"updateValue\", modalData);\n      setModalData({\n        price: modalData.price,\n        start: modalData.start,\n        end: modalData.end\n      });\n    } else {\n      dispatch(propertyActions.createPriceItem({\n        start_date: modalData.start,\n        end_date: modalData.end,\n        price: modalData.price,\n        property: propertyId\n      }, dispatch));\n      setModalVisible(false);\n    }\n  };\n\n  return __jsx(CalendarStyleWrapper, {\n    className: \"isomorphicCalendarWrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }\n  }, __jsx(ModalEvents, {\n    modalVisible: modalVisible,\n    modalData: modalData,\n    onModalDataChange: handleChangeModalData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }), __jsx(Calendar // className=\"isomorphicCalendar\"\n  // selectable\n  // localizer={Localizer}\n  // onView={onView}\n  // defaultView=\"month\"\n  // step={60}\n  , {\n    selectable: true,\n    resizable: true,\n    events: pricingItems,\n    views: [\"month\"],\n    defaultDate: new Date(),\n    defaultView: \"month\",\n    toolbar: true,\n    localizer: Localizer,\n    step: 30,\n    components: {\n      month: {\n        dateHeader: function dateHeader(_ref2) {\n          var date = _ref2.date,\n              label = _ref2.label;\n          var pricingItem = pricingItems.find(function (item) {\n            return moment(date).isBetween(moment(item.start), moment(item.end), null, \"[]\");\n          });\n          return __jsx(\"div\", {\n            className: \"calendar-date-cell\",\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 121,\n              columnNumber: 33\n            }\n          }, __jsx(\"h4\", {\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 37\n            }\n          }, moment(date).date()), __jsx(\"h6\", {\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 37\n            }\n          }, \"$\", \" \", pricingItem !== undefined ? pricingItem.price : defaultPrice));\n        }\n      }\n    },\n    onSelectSlot: handleSlotSelection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }));\n}\n\n_s(PricingCalendar, \"vjiETSwaCuati1uPHYXtgV87/io=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c2 = PricingCalendar;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"DragAndDropCalendar\");\n$RefreshReg$(_c2, \"PricingCalendar\");","map":{"version":3,"sources":["E:/Projects/starsofboston/next-django/isomorphic-next/components/Admin/Property/PricingCalendar/PricingCalendar.js"],"names":["React","useState","useEffect","useDispatch","useSelector","moment","Calendar","momentLocalizer","withDragAndDrop","ModalEvents","notification","propertyActions","CalendarStyleWrapper","Localizer","DragAndDropCalendar","PricingCalendar","props","propertyId","defaultPrice","pricingItems","setPricingItems","modalVisible","setModalVisible","modalData","setModalData","dispatch","state","Properties","selectedItem","getPricingData","newItems","map","item","index","price","allDay","start","start_date","end","end_date","console","log","getPriceItems","handleSlotSelection","action","convertDate","date","offset","getTimezoneOffset","newDate","Date","getTime","toISOString","split","handleChangeModalData","type","createPriceItem","property","month","dateHeader","label","pricingItem","find","isBetween","undefined"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport moment from \"moment\";\nimport {Calendar, momentLocalizer} from \"react-big-calendar\";\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\nimport ModalEvents from \"./ModalEvents\";\nimport notification from \"@iso/components/Notification\";\nimport propertyActions from \"@redux/properties/actions\";\n\nimport {CalendarStyleWrapper} from \"./Calendar.styles\";\n\nconst Localizer = momentLocalizer(moment);\nconst DragAndDropCalendar = withDragAndDrop(Calendar);\n\nexport default function PricingCalendar(props) {\n    const {propertyId, defaultPrice} = props;\n\n    const [pricingItems, setPricingItems] = useState([]);\n    const [modalVisible, setModalVisible] = useState(false);\n    const [modalData, setModalData] = useState(null);\n\n    const dispatch = useDispatch();\n    const {selectedItem} = useSelector((state) => state.Properties);\n\n    useEffect(() => {\n        getPricingData(propertyId);\n    }, []);\n\n    useEffect(() => {\n        if (selectedItem.pricingItems) {\n            const newItems = selectedItem.pricingItems.map((item, index) => ({\n                price: item.price,\n                allDay: true,\n                start: item.start_date,\n                end: item.end_date,\n            }));\n            setPricingItems(newItems);\n            console.log(\"selectedItem\", newItems, pricingItems)\n        }\n    }, [selectedItem]);\n\n    async function getPricingData() {\n        dispatch(propertyActions.getPriceItems(propertyId));\n    }\n\n    const handleSlotSelection = ({start, end, action}) => {\n        setModalVisible(true);\n        setModalData({\n            price: defaultPrice,\n            start: convertDate(start),\n            end: convertDate(end),\n        });\n    };\n\n    const convertDate = (date) => {\n        const offset = date.getTimezoneOffset();\n        console.log(\"offset\", offset);\n        const newDate = new Date(date.getTime() - offset * 60 * 1000);\n        return newDate.toISOString().split(\"T\")[0];\n    };\n\n    const handleChangeModalData = (type, modalData) => {\n        if (type === \"cancel\") {\n            setModalVisible(false);\n            setModalData(null);\n        } else if (type === \"delete\") {\n            // some logic to delete pricing item\n        } else if (type === \"updateValue\") {\n            console.log(\"updateValue\", modalData);\n            setModalData({\n                price: modalData.price,\n                start: modalData.start,\n                end: modalData.end,\n            });\n        } else {\n            dispatch(propertyActions.createPriceItem({\n                start_date: modalData.start,\n                end_date: modalData.end,\n                price: modalData.price,\n                property: propertyId\n            }, dispatch));\n            setModalVisible(false)\n        }\n    };\n\n    return (\n        <CalendarStyleWrapper className=\"isomorphicCalendarWrapper\">\n            <ModalEvents\n                modalVisible={modalVisible}\n                modalData={modalData}\n                onModalDataChange={handleChangeModalData}\n            />\n            <Calendar\n                // className=\"isomorphicCalendar\"\n                // selectable\n                // localizer={Localizer}\n                // onView={onView}\n                // defaultView=\"month\"\n                // step={60}\n                selectable\n                resizable\n                events={pricingItems}\n                views={[\"month\"]}\n                defaultDate={new Date()}\n                defaultView=\"month\"\n                toolbar={true}\n                localizer={Localizer}\n                step={30}\n                components={{\n                    month: {\n                        dateHeader: ({date, label}) => {\n                            let pricingItem = pricingItems.find((item) =>\n                                moment(date).isBetween(\n                                    moment(item.start),\n                                    moment(item.end),\n                                    null,\n                                    \"[]\"\n                                )\n                            );\n                            return (\n                                <div className=\"calendar-date-cell\">\n                                    <h4>{moment(date).date()}</h4>\n                                    <h6>\n                                        ${\" \"}\n                                        {pricingItem !== undefined\n                                            ? pricingItem.price\n                                            : defaultPrice}\n                                    </h6>\n                                </div>\n                            );\n                        },\n                    },\n                }}\n                onSelectSlot={handleSlotSelection}\n            />\n\n        </CalendarStyleWrapper>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}